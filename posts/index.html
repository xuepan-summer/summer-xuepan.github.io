<!DOCTYPE html>
<html>
<head>
    <title>Title</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="https://xuepan-summer.github.io/summer-xuepan.github.io/assets/css/main.css"/>
    <noscript><link rel="stylesheet" href="https://xuepan-summer.github.io/summer-xuepan.github.io/assets/css/noscript.css"/></noscript>
    <style>
        :root{--site-background : url("https://xuepan-summer.github.io/summer-xuepan.github.io/images/bg.jpg")};
    </style> 
    
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>

<body class="is-preload">

    
        <div id="wrapper">

            
                <header id="header">
                    <div class="logo">
                        <a href="/"><span class="icon fa-"></span></a>
                    </div>
                    <div class="content">
                        <div class="inner">
                            <h1>Posts</h1>
                            
                        </div>
                    </div>
                    <nav>
                        <ul>
                            
                                
                                    
                                        <li>
                                            <a href="#5oir55qe56ys5lia56%2bh5y2a5a6i">我的第一篇博客</a>
                                        </li>
                                    
                                
                            
                                
                                    
                                        <li>
                                            <a href="#shvnb%2baqrew7uus4qus6uuwnmuwuog">Hugo搭建个人博客</a>
                                        </li>
                                    
                                
                            
                                
                                    
                                        <li>
                                            <a href="#57g755qe6k6%2f6zeu5o6n5yi256ymchvibglj44cbchjvdgvjdgvk44cbzgvmyxvsdooagxbyaxzhdgu">类的访问控制符public、protected、default、private</a>
                                        </li>
                                    
                                
                            
                                
                                    
                                        <li>
                                            <a href="#smf2yeeahowmheeuoeeqhus4jk1hdmvu">Java的包管理与Maven</a>
                                        </li>
                                    
                                
                            
                                
                                    
                                        <li>
                                            <a href="#q29sbgvjdglvbus9k%2bezu%2beahow4uoeuqoexu%2bwpiuwftuidjowqjueahoavsoanrue7k%2baeha">Collection体系的常用类及其背后的数据结构</a>
                                        </li>
                                    
                                
                            
                                
                                    
                                        <li>
                                            <a href="#5rex5ou36lsd5lio5rwf5ou36lsd">深拷贝与浅拷贝</a>
                                        </li>
                                    
                                
                            
                                
                                    
                                        <li>
                                            <a href="#5asa57q%2f56il">多线程</a>
                                        </li>
                                    
                                
                            
                                
                                    
                                        <li>
                                            <a href="#5a6e546w55sf5lqn6icf5rai6ls56icfkos4gcnvvjp3ywl0kckgjibub3rpznkokq">实现生产者消费者(一)：wait() &amp; notify()</a>
                                        </li>
                                    
                                
                            
                                
                                    
                                        <li>
                                            <a href="#5a6e546w55sf5lqn6icf5rai6ls56icfkos6jcnvvjpmb2nricygq29uzgl0aw9u">实现生产者消费者(二)：Lock &amp; Condition</a>
                                        </li>
                                    
                                
                            
                                
                                    
                                        <li>
                                            <a href="#5a6e546w55sf5lqn6icf5rai6ls56icfkos4isnvvjpcbg9ja2luz1f1zxvl">实现生产者消费者(三)：BlockingQueue</a>
                                        </li>
                                    
                                
                            
                                
                                    
                                        <li>
                                            <a href="#tgludxjluljnlkjlkb3ku6tmglvnu5m">Linux常用命令总结</a>
                                        </li>
                                    
                                
                            
                        </ul>
                    </nav>
                </header>

            
                <div id="main">

                    
                        
                            
                                <article id="tgludxjluljnlkjlkb3ku6tmglvnu5m">
                                    <h2 class="major">Linux常用命令总结</h2>
                                    <span class="image main"><img src="" alt="" /></span>
                                    <p>平时工作中有时候会用到一些常用的Linux命令，所以打算整理一下，便于翻阅，后续再补充</p>
<ol>
<li>
<p><strong>目录切换命令</strong></p>
<ul>
<li>pwd   查看当前路径</li>
</ul>
<ul>
<li>
<p>cd 目录名   切换到指定目录下</p>
<p><!-- raw HTML omitted -->【cd命令系列】<!-- raw HTML omitted --></p>
<ul>
<li>
<p>cd ../   切换到上级目录</p>
</li>
<li>
<p>cd /   切换到根目录（所有用户共享的目录）</p>
</li>
<li>
<p>cd ~   切换到用户主目录，root用户相当于cd /root；普通用户相当于cd /home/当前用户名</p>
</li>
<li>
<p>cd -   切换到上一个所在目录（此目录之前所在目录）</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>目录或文件操作命令</strong></p>
<ul>
<li>
<p>ls   显示不隐藏的文件或文件夹</p>
</li>
<li>
<p>ls -a   显示当前目录下所有文件及文件夹，包括隐藏的.和..</p>
</li>
<li>
<p>ls -l   显示不隐藏的文件与文件夹的详细信息 =&gt;即 ll</p>
</li>
<li>
<p>mkdir   目录名 创建目录</p>
</li>
<li>
<p>touch 文件名   新建文件</p>
<p><!-- raw HTML omitted -->【mv命令系列】<!-- raw HTML omitted --></p>
</li>
<li>
<p>mv 旧文件 新文件   对文件重命名</p>
</li>
<li>
<p>mv 文件 目录   将文件移动到目录中</p>
</li>
<li>
<p>mv 旧目录名 新目录名   新目录存在则将旧目录移动进去，不存在就新建</p>
</li>
<li>
<p>cp (-r) 目录名 目标路径   拷贝目录或文件；单个文件不需要-r（表示递归）</p>
<p><!-- raw HTML omitted -->【文件查看命令系列】<!-- raw HTML omitted --></p>
<ul>
<li>
<p>cat 默认最后一屏内容</p>
</li>
<li>
<p>more 百分比 回车下一行，空格下一页，q退出查看</p>
</li>
<li>
<p>less PgUp/PgDn上下翻页，q退出查看</p>
</li>
<li>
<p>tail -N 查看文件后N行</p>
</li>
</ul>
<p><!-- raw HTML omitted -->【VIM命令系列】<!-- raw HTML omitted --></p>
<p>三种模式： <strong>命令模式（Command mode）</strong>，<strong>输入模式（Insert mode）<strong>和</strong>底线命令模式（Last line mode）</strong></p>
<p>三种模式转换如图所示：</p>
<p><img src="/images/vim-vi-workmodel.png" alt=""></p>
<p>简单的编辑过程如下：</p>
<ul>
<li>vi 文件名</li>
<li>按i进入编辑模式</li>
<li>进行内容编辑</li>
<li>按Esc回到命令模式</li>
<li>:wq 保存并退出或者:q!强制退出</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>压缩和解压缩</strong></p>
<ul>
<li>解包：tar zxvf filename.tar</li>
<li>打包：tar czvf filename.tar dirname</li>
<li>解压：unzip filename.zip</li>
<li>压缩：zip filename.zip dirname</li>
</ul>
</li>
<li>
<p><strong>权限命令</strong></p>
<ul>
<li>
<p>chmod 权限 文件名</p>
<p><!-- raw HTML omitted -->【Linux权限表示方式】<!-- raw HTML omitted --></p>
<p>数字4、2、1分别代表读r(read)、写w(write)、执行x(execute)权限</p>
<p>针对拥有者、群组、其他组都需要设置读写执行这三种权限</p>
<p>7=4+2+1</p>
<p>因此777表示拥有者、群组和其他组都具有读写执行权限，其他以此类推。</p>
</li>
</ul>
</li>
</ol>

                                </article>
                            
                        
                    
                        
                            
                                <article id="5a6e546w55sf5lqn6icf5rai6ls56icfkos4isnvvjpcbg9ja2luz1f1zxvl">
                                    <h2 class="major">实现生产者消费者(三)：BlockingQueue</h2>
                                    <span class="image main"><img src="" alt="" /></span>
                                    <ol>
<li>生产者-消费者模型介绍</li>
</ol>
<p>生产者和消费者同一时间使用同一存储空间，生产者往空间里放东西，消费者从空间里拿东西</p>
<p>现在要实现的是：生产者生产十个随机数供消费者使用，消费者依次消耗十个随机数，相当于生产者生产一个随机数，就放在盘子里，然后消费者消费。生产者再生产，消费者再消费，直至十个随机数被消耗完，整个过程结束。</p>
<ol start="2">
<li>采用BlockingQueue方法</li>
</ol>
<p>BlockingQueue是接口，顾名思义，就是阻塞队列，队列中有空位才插入元素，队列中有元素才移除元素。</p>
<p><strong>offer() &amp; put()</strong></p>
<p>boolean offer(E e);若可以成功添加，返回true，否则返回false &ndash;&gt;非阻塞</p>
<p>boolean offer(E e, long timeout, TimeUnit unit)    throws InterruptedException;</p>
<p>设定等待时间，如果指定时间内，还不能往队列中加入元素，则返回false &ndash;&gt;阻塞</p>
<p>void put(E e) throws InterruptedException;是阻塞的，如果队列内无空位，则一直等待，直到有空位才往队列中插入元素 &ndash;&gt;阻塞</p>
<p><strong>poll() &amp; take()</strong></p>
<p>E poll(long timeout, TimeUnit unit) throws InterruptedException;取出队首元素，可取出就直接返回，否则等待，超时还未取出则失败</p>
<p>E take() throws InterruptedException;取出队首元素，阻塞等待直到可取出</p>
<p>JDK文档的注释中有相关使用范例代码，如下所示：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BoundedBuffer</span> <span style="color:#f92672">{</span>    
    <span style="color:#66d9ef">final</span> Lock lock <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ReentrantLock<span style="color:#f92672">();</span>    
    <span style="color:#66d9ef">final</span> Condition notFull <span style="color:#f92672">=</span> lock<span style="color:#f92672">.</span><span style="color:#a6e22e">newCondition</span><span style="color:#f92672">();</span>    
    <span style="color:#66d9ef">final</span> Condition notEmpty <span style="color:#f92672">=</span> lock<span style="color:#f92672">.</span><span style="color:#a6e22e">newCondition</span><span style="color:#f92672">();</span>    
    <span style="color:#66d9ef">final</span> Object<span style="color:#f92672">[]</span> items <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Object<span style="color:#f92672">[</span>100<span style="color:#f92672">];</span>    
    <span style="color:#66d9ef">int</span> putptr<span style="color:#f92672">,</span> takeptr<span style="color:#f92672">,</span> count<span style="color:#f92672">;</span>    
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>Object x<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> InterruptedException <span style="color:#f92672">{</span>
        lock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>        
        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>            
            <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>count <span style="color:#f92672">==</span> items<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">)</span>                
                notFull<span style="color:#f92672">.</span><span style="color:#a6e22e">await</span><span style="color:#f92672">();</span>            
            items<span style="color:#f92672">[</span>putptr<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> x<span style="color:#f92672">;</span>            
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(++</span>putptr <span style="color:#f92672">==</span> items<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">)</span> putptr <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>            
            <span style="color:#f92672">++</span>count<span style="color:#f92672">;</span>           
            notEmpty<span style="color:#f92672">.</span><span style="color:#a6e22e">signal</span><span style="color:#f92672">();</span>        
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>            
            lock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>        
        <span style="color:#f92672">}</span>    
    <span style="color:#f92672">}</span>    
    
    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">take</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> InterruptedException <span style="color:#f92672">{</span>        
        lock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>        
        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>            
            <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>count <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span>                
                notEmpty<span style="color:#f92672">.</span><span style="color:#a6e22e">await</span><span style="color:#f92672">();</span>            
            Object x <span style="color:#f92672">=</span> items<span style="color:#f92672">[</span>takeptr<span style="color:#f92672">];</span>            
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(++</span>takeptr <span style="color:#f92672">==</span> items<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">)</span> takeptr <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>            
            <span style="color:#f92672">--</span>count<span style="color:#f92672">;</span>            
            notFull<span style="color:#f92672">.</span><span style="color:#a6e22e">signal</span><span style="color:#f92672">();</span>            
            <span style="color:#66d9ef">return</span> x<span style="color:#f92672">;</span>        
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>            
            lock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>        
        <span style="color:#f92672">}</span>    
    <span style="color:#f92672">}}</span>
</code></pre></div><p>BlockingQueue的特性结合生产者-消费者问题可得整体思路是：</p>
<p>生产者：</p>
<p>①生产随机数</p>
<p>②将数据存到BlockingQueue</p>
<p>消费者：
①从队列中取数据</p>
<p>②消费数据</p>
<p>①上锁lock()</p>
<p>②盘子里没有东西时，生产者开始生产随机数，<!-- raw HTML omitted -->唤醒消费者<!-- raw HTML omitted --></p>
<p>盘子里有东西时，生产者等待await()</p>
<p>③解锁unlock()</p>
<p>消费者：
①上锁lock()</p>
<p>②盘子里有东西时，消费者开始消费随机数，<strong>然后将盘子置为空</strong>，<!-- raw HTML omitted -->唤醒生产者<!-- raw HTML omitted --></p>
<p>盘子里没有东西时，消费者等待await()</p>
<p>③解锁unlock()</p>
<p>3.具体代码实现</p>
<p>（1）首先需要一个盘子，采用Optional类作为盘子，value相当于盘子里的值(生产者生产完一个就放在盘子里，消费者从盘子里拿走)</p>
<p>Optional类常用的方法有：</p>
<ul>
<li>empty()  将内容置空</li>
<li>isPresent()  里面的内容是否存在</li>
<li>of(xxx)  返回一个Optional对象，将xxx存在里面</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> java.util.Optional<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Container</span> <span style="color:#f92672">{</span>    
    Optional<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> value <span style="color:#f92672">=</span> Optional<span style="color:#f92672">.</span><span style="color:#a6e22e">empty</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">public</span> Optional<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getValue</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>        
        <span style="color:#66d9ef">return</span> value<span style="color:#f92672">;</span>    
    <span style="color:#f92672">}</span>    
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setValue</span><span style="color:#f92672">(</span>Optional<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> value<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>        
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> value<span style="color:#f92672">;</span>    
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>（2）ProducerConsumer里有两个内部类，分别是Producer和Consumer</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> java.util.Optional<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.Random<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.concurrent.locks.Condition<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.concurrent.locks.Lock<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.concurrent.locks.ReentrantLock<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProducerConsumer</span> <span style="color:#f92672">{</span>    
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> InterruptedException <span style="color:#f92672">{</span>
        Container container <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Container<span style="color:#f92672">();</span>
        <span style="color:#75715e">//定义一个可重入锁
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">final</span> Lock lock <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ReentrantLock<span style="color:#f92672">();</span>
        <span style="color:#75715e">//通过lock.newCondition()得到两个Condition对象
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">final</span> Condition sender <span style="color:#f92672">=</span> lock<span style="color:#f92672">.</span><span style="color:#a6e22e">newCondition</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">final</span> Condition receiver <span style="color:#f92672">=</span> lock<span style="color:#f92672">.</span><span style="color:#a6e22e">newCondition</span><span style="color:#f92672">();</span>     
        
        Producer producer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Producer<span style="color:#f92672">(</span>lock<span style="color:#f92672">,</span> sender<span style="color:#f92672">,</span> receiver<span style="color:#f92672">,</span> container<span style="color:#f92672">);</span>
        Consumer consumer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Consumer<span style="color:#f92672">(</span>lock<span style="color:#f92672">,</span> sender<span style="color:#f92672">,</span> receiver<span style="color:#f92672">,</span> container<span style="color:#f92672">);</span> 
        
        producer<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>        
        consumer<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>        
        producer<span style="color:#f92672">.</span><span style="color:#a6e22e">join</span><span style="color:#f92672">();</span>        
        consumer<span style="color:#f92672">.</span><span style="color:#a6e22e">join</span><span style="color:#f92672">();</span>    
    <span style="color:#f92672">}</span>    
    
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Producer</span> <span style="color:#66d9ef">extends</span> Thread <span style="color:#f92672">{</span>
        Lock lock<span style="color:#f92672">;</span>
        Condition sender<span style="color:#f92672">;</span>
        Condition receiver<span style="color:#f92672">;</span>
        Container container<span style="color:#f92672">;</span>

        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Producer</span><span style="color:#f92672">(</span>Lock lock<span style="color:#f92672">,</span> Condition sender<span style="color:#f92672">,</span> Condition receiver<span style="color:#f92672">,</span> Container container<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span> <span style="color:#f92672">=</span> lock<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">sender</span> <span style="color:#f92672">=</span> sender<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">receiver</span> <span style="color:#f92672">=</span> receiver<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">container</span> <span style="color:#f92672">=</span> container<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#a6e22e">@Override</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 10<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
                <span style="color:#75715e">//上锁
</span><span style="color:#75715e"></span>                lock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>
                <span style="color:#75715e">//容器内无值时，生产者生产随机数
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">while</span> <span style="color:#f92672">(!</span>container<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">isPresent</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">int</span> r <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Random<span style="color:#f92672">().</span><span style="color:#a6e22e">nextInt</span><span style="color:#f92672">();</span>
                    container<span style="color:#f92672">.</span><span style="color:#a6e22e">setValue</span><span style="color:#f92672">(</span>Optional<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span>r<span style="color:#f92672">));</span>
                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Producing &#34;</span> <span style="color:#f92672">+</span> r<span style="color:#f92672">);</span>
                    <span style="color:#75715e">//生产完之后唤醒消费者
</span><span style="color:#75715e"></span>                    receiver<span style="color:#f92672">.</span><span style="color:#a6e22e">signal</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span>
                <span style="color:#75715e">//容器内有值时，生产者等待
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                    sender<span style="color:#f92672">.</span><span style="color:#a6e22e">await</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span>
                <span style="color:#75715e">//解锁
</span><span style="color:#75715e"></span>                lock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Consumer</span> <span style="color:#66d9ef">extends</span> Thread <span style="color:#f92672">{</span>
        Lock lock<span style="color:#f92672">;</span>
        Condition sender<span style="color:#f92672">;</span>
        Condition receiver<span style="color:#f92672">;</span>
        Container container<span style="color:#f92672">;</span>

        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Consumer</span><span style="color:#f92672">(</span>Lock lock<span style="color:#f92672">,</span> Condition sender<span style="color:#f92672">,</span> Condition receiver<span style="color:#f92672">,</span> Container container<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span> <span style="color:#f92672">=</span> lock<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">sender</span> <span style="color:#f92672">=</span> sender<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">receiver</span> <span style="color:#f92672">=</span> receiver<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">container</span> <span style="color:#f92672">=</span> container<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#a6e22e">@Override</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 10<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
                <span style="color:#75715e">//上锁
</span><span style="color:#75715e"></span>                lock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>
                <span style="color:#75715e">//容器内有值时，消费者消费，并将容器置为空
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>container<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">isPresent</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Consuming &#34;</span> <span style="color:#f92672">+</span> container<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">());</span>
                    container<span style="color:#f92672">.</span><span style="color:#a6e22e">setValue</span><span style="color:#f92672">(</span>Optional<span style="color:#f92672">.</span><span style="color:#a6e22e">empty</span><span style="color:#f92672">());</span>
                    <span style="color:#75715e">//唤醒生产者
</span><span style="color:#75715e"></span>                    sender<span style="color:#f92672">.</span><span style="color:#a6e22e">signal</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span>
                <span style="color:#75715e">//容器内无值时，消费者等待
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                    receiver<span style="color:#f92672">.</span><span style="color:#a6e22e">await</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>运行结果如下图所示。进行了十次依次进行生产消费随机数的过程。</p>
<p><img src="/images/ProducerAndConsumer3.png" alt=""></p>

                                </article>
                            
                        
                    
                        
                            
                                <article id="5a6e546w55sf5lqn6icf5rai6ls56icfkos6jcnvvjpmb2nricygq29uzgl0aw9u">
                                    <h2 class="major">实现生产者消费者(二)：Lock &amp; Condition</h2>
                                    <span class="image main"><img src="" alt="" /></span>
                                    <ol>
<li>生产者-消费者模型介绍</li>
</ol>
<p>生产者和消费者同一时间使用同一存储空间，生产者往空间里放东西，消费者从空间里拿东西</p>
<p>现在要实现的是：生产者生产十个随机数供消费者使用，消费者依次消耗十个随机数，相当于生产者生产一个随机数，就放在盘子里，然后消费者消费。生产者再生产，消费者再消费，直至十个随机数被消耗完，整个过程结束。</p>
<ol start="2">
<li>采用Lock &amp; Condition方法</li>
</ol>
<p>Lock是接口，里面有lock()方法和unlock()方法，除此之外，还有tryLock()方法、newCondition()方法等。相比于synchronized更加灵活，因为synchronized默认在出作用域的时候释放资源，相当于解锁。所以Lock可以更加灵活地控制何时上锁，何时解锁。</p>
<p>Condition也是接口，主要是await()方法和signal()/signalAll()方法。signal()方法会唤醒一个正在等待该Condition的线程，而signalAll()方法会唤醒所有正在等待该Condition的线程。</p>
<p>JDK文档的注释中有相关使用范例代码，如下所示：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BoundedBuffer</span> <span style="color:#f92672">{</span>    
    <span style="color:#66d9ef">final</span> Lock lock <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ReentrantLock<span style="color:#f92672">();</span>    
    <span style="color:#66d9ef">final</span> Condition notFull <span style="color:#f92672">=</span> lock<span style="color:#f92672">.</span><span style="color:#a6e22e">newCondition</span><span style="color:#f92672">();</span>    
    <span style="color:#66d9ef">final</span> Condition notEmpty <span style="color:#f92672">=</span> lock<span style="color:#f92672">.</span><span style="color:#a6e22e">newCondition</span><span style="color:#f92672">();</span>    
    <span style="color:#66d9ef">final</span> Object<span style="color:#f92672">[]</span> items <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Object<span style="color:#f92672">[</span>100<span style="color:#f92672">];</span>    
    <span style="color:#66d9ef">int</span> putptr<span style="color:#f92672">,</span> takeptr<span style="color:#f92672">,</span> count<span style="color:#f92672">;</span>    
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>Object x<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> InterruptedException <span style="color:#f92672">{</span>
        lock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>        
        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>            
            <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>count <span style="color:#f92672">==</span> items<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">)</span>                
                notFull<span style="color:#f92672">.</span><span style="color:#a6e22e">await</span><span style="color:#f92672">();</span>            
            items<span style="color:#f92672">[</span>putptr<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> x<span style="color:#f92672">;</span>            
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(++</span>putptr <span style="color:#f92672">==</span> items<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">)</span> putptr <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>            
            <span style="color:#f92672">++</span>count<span style="color:#f92672">;</span>           
            notEmpty<span style="color:#f92672">.</span><span style="color:#a6e22e">signal</span><span style="color:#f92672">();</span>        
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>            
            lock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>        
        <span style="color:#f92672">}</span>    
    <span style="color:#f92672">}</span>    
    
    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">take</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> InterruptedException <span style="color:#f92672">{</span>        
        lock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>        
        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>            
            <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>count <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span>                
                notEmpty<span style="color:#f92672">.</span><span style="color:#a6e22e">await</span><span style="color:#f92672">();</span>            
            Object x <span style="color:#f92672">=</span> items<span style="color:#f92672">[</span>takeptr<span style="color:#f92672">];</span>            
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(++</span>takeptr <span style="color:#f92672">==</span> items<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">)</span> takeptr <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>            
            <span style="color:#f92672">--</span>count<span style="color:#f92672">;</span>            
            notFull<span style="color:#f92672">.</span><span style="color:#a6e22e">signal</span><span style="color:#f92672">();</span>            
            <span style="color:#66d9ef">return</span> x<span style="color:#f92672">;</span>        
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>            
            lock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>        
        <span style="color:#f92672">}</span>    
    <span style="color:#f92672">}}</span>
</code></pre></div><p>上述代码结合生产者-消费者问题可得整体思路是：</p>
<p>生产者：
①上锁lock()</p>
<p>②盘子里没有东西时，生产者开始生产随机数，<!-- raw HTML omitted -->唤醒消费者<!-- raw HTML omitted --></p>
<p>盘子里有东西时，生产者等待await()</p>
<p>③解锁unlock()</p>
<p>消费者：
①上锁lock()</p>
<p>②盘子里有东西时，消费者开始消费随机数，<strong>然后将盘子置为空</strong>，<!-- raw HTML omitted -->唤醒生产者<!-- raw HTML omitted --></p>
<p>盘子里没有东西时，消费者等待await()</p>
<p>③解锁unlock()</p>
<p>3.具体代码实现</p>
<p>（1）首先需要一个盘子，采用Optional类作为盘子，value相当于盘子里的值(生产者生产完一个就放在盘子里，消费者从盘子里拿走)</p>
<p>Optional类常用的方法有：</p>
<ul>
<li>empty()  将内容置空</li>
<li>isPresent()  里面的内容是否存在</li>
<li>of(xxx)  返回一个Optional对象，将xxx存在里面</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> java.util.Optional<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Container</span> <span style="color:#f92672">{</span>    
    Optional<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> value <span style="color:#f92672">=</span> Optional<span style="color:#f92672">.</span><span style="color:#a6e22e">empty</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">public</span> Optional<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getValue</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>        
        <span style="color:#66d9ef">return</span> value<span style="color:#f92672">;</span>    
    <span style="color:#f92672">}</span>    
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setValue</span><span style="color:#f92672">(</span>Optional<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> value<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>        
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> value<span style="color:#f92672">;</span>    
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>（2）ProducerConsumer里有两个内部类，分别是Producer和Consumer</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> java.util.Optional<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.Random<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.concurrent.locks.Condition<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.concurrent.locks.Lock<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.concurrent.locks.ReentrantLock<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProducerConsumer</span> <span style="color:#f92672">{</span>    
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> InterruptedException <span style="color:#f92672">{</span>
        Container container <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Container<span style="color:#f92672">();</span>
        <span style="color:#75715e">//定义一个可重入锁
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">final</span> Lock lock <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ReentrantLock<span style="color:#f92672">();</span>
        <span style="color:#75715e">//通过lock.newCondition()得到两个Condition对象
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">final</span> Condition sender <span style="color:#f92672">=</span> lock<span style="color:#f92672">.</span><span style="color:#a6e22e">newCondition</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">final</span> Condition receiver <span style="color:#f92672">=</span> lock<span style="color:#f92672">.</span><span style="color:#a6e22e">newCondition</span><span style="color:#f92672">();</span>     
        
        Producer producer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Producer<span style="color:#f92672">(</span>lock<span style="color:#f92672">,</span> sender<span style="color:#f92672">,</span> receiver<span style="color:#f92672">,</span> container<span style="color:#f92672">);</span>
        Consumer consumer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Consumer<span style="color:#f92672">(</span>lock<span style="color:#f92672">,</span> sender<span style="color:#f92672">,</span> receiver<span style="color:#f92672">,</span> container<span style="color:#f92672">);</span> 
        
        producer<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>        
        consumer<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>        
        producer<span style="color:#f92672">.</span><span style="color:#a6e22e">join</span><span style="color:#f92672">();</span>        
        consumer<span style="color:#f92672">.</span><span style="color:#a6e22e">join</span><span style="color:#f92672">();</span>    
    <span style="color:#f92672">}</span>    
    
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Producer</span> <span style="color:#66d9ef">extends</span> Thread <span style="color:#f92672">{</span>
        Lock lock<span style="color:#f92672">;</span>
        Condition sender<span style="color:#f92672">;</span>
        Condition receiver<span style="color:#f92672">;</span>
        Container container<span style="color:#f92672">;</span>

        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Producer</span><span style="color:#f92672">(</span>Lock lock<span style="color:#f92672">,</span> Condition sender<span style="color:#f92672">,</span> Condition receiver<span style="color:#f92672">,</span> Container container<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span> <span style="color:#f92672">=</span> lock<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">sender</span> <span style="color:#f92672">=</span> sender<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">receiver</span> <span style="color:#f92672">=</span> receiver<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">container</span> <span style="color:#f92672">=</span> container<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#a6e22e">@Override</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 10<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
                <span style="color:#75715e">//上锁
</span><span style="color:#75715e"></span>                lock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>
                <span style="color:#75715e">//容器内无值时，生产者生产随机数
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">while</span> <span style="color:#f92672">(!</span>container<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">isPresent</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">int</span> r <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Random<span style="color:#f92672">().</span><span style="color:#a6e22e">nextInt</span><span style="color:#f92672">();</span>
                    container<span style="color:#f92672">.</span><span style="color:#a6e22e">setValue</span><span style="color:#f92672">(</span>Optional<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span>r<span style="color:#f92672">));</span>
                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Producing &#34;</span> <span style="color:#f92672">+</span> r<span style="color:#f92672">);</span>
                    <span style="color:#75715e">//生产完之后唤醒消费者
</span><span style="color:#75715e"></span>                    receiver<span style="color:#f92672">.</span><span style="color:#a6e22e">signal</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span>
                <span style="color:#75715e">//容器内有值时，生产者等待
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                    sender<span style="color:#f92672">.</span><span style="color:#a6e22e">await</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span>
                <span style="color:#75715e">//解锁
</span><span style="color:#75715e"></span>                lock<span style="color:#f92672">.</span><span style="color:#a6e22e">unlock</span><span style="color:#f92672">();</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Consumer</span> <span style="color:#66d9ef">extends</span> Thread <span style="color:#f92672">{</span>
        Lock lock<span style="color:#f92672">;</span>
        Condition sender<span style="color:#f92672">;</span>
        Condition receiver<span style="color:#f92672">;</span>
        Container container<span style="color:#f92672">;</span>

        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Consumer</span><span style="color:#f92672">(</span>Lock lock<span style="color:#f92672">,</span> Condition sender<span style="color:#f92672">,</span> Condition receiver<span style="color:#f92672">,</span> Container container<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span> <span style="color:#f92672">=</span> lock<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">sender</span> <span style="color:#f92672">=</span> sender<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">receiver</span> <span style="color:#f92672">=</span> receiver<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">container</span> <span style="color:#f92672">=</span> container<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#a6e22e">@Override</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 10<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
                <span style="color:#75715e">//上锁
</span><span style="color:#75715e"></span>                lock<span style="color:#f92672">.</span><span style="color:#a6e22e">lock</span><span style="color:#f92672">();</span>
                <span style="color:#75715e">//容器内有值时，消费者消费，并将容器置为空
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>container<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">isPresent</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Consuming &#34;</span> <span style="color:#f92672">+</span> container<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">());</span>
                    container<span style="color:#f92672">.</span><span style="color:#a6e22e">setValue</span><span style="color:#f92672">(</span>Optional<span style="color:#f92672">.</span><span style="color:#a6e22e">empty</span><span style="color:#f92672">());</span>
                    <span style="color:#75715e">//唤醒生产者
</span><span style="color:#75715e"></span>                    sender<span style="color:#f92672">.</span><span style="color:#a6e22e">signal</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span>
                <span style="color:#75715e">//容器内无值时，消费者等待
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                    receiver<span style="color:#f92672">.</span><span style="color:#a6e22e">await</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>运行结果如下图所示。进行了十次依次进行生产消费随机数的过程。</p>
<p><img src="/images/ProducerAndConsumer2.png" alt=""></p>

                                </article>
                            
                        
                    
                        
                            
                                <article id="5a6e546w55sf5lqn6icf5rai6ls56icfkos4gcnvvjp3ywl0kckgjibub3rpznkokq">
                                    <h2 class="major">实现生产者消费者(一)：wait() &amp; notify()</h2>
                                    <span class="image main"><img src="" alt="" /></span>
                                    <ol>
<li>生产者-消费者模型介绍</li>
</ol>
<p>生产者和消费者同一时间使用同一存储空间，生产者往空间里放东西，消费者从空间里拿东西</p>
<p>现在要实现的是：生产者生产十个随机数供消费者使用，消费者依次消耗十个随机数，相当于生产者生产一个随机数，就放在盘子里，然后消费者消费。生产者再生产，消费者再消费，直至十个随机数被消耗完，整个过程结束。</p>
<ol start="2">
<li>采用Object.wait() &amp; notify()/notifyAll()方法</li>
</ol>
<p>wait()表示让该线程等待</p>
<p>notify()/notifyAll()</p>
<pre><code>Wakes up a single thread that is waiting on this object's monitor.
If any threads are waiting on this object, one of them is chosen to be awakened. The choice is arbitrary and occurs at the discretion of the implementation. A thread waits on an object's monitor by calling one of the {@code wait} methods.
</code></pre><p>notify()会随机唤醒一个等待该资源的线程</p>
<pre><code>Wakes up all threads that are waiting on this object's monitor. A thread waits on an object's monitor by calling one of the {@code wait} methods.  
The awakened threads will not be able to proceed until the current thread relinquishes the lock on this object. The awakened threads will compete in the usual manner with any other threads that might be actively competing to synchronize on this object; for example, the awakened threads enjoy no reliable privilege or disadvantage in* being the next thread to lock this object.
</code></pre><p>notifyAll()会将所有等待该资源的线程唤醒，然后让它们公平竞争，最终只选择一个线程</p>
<p>JDK文档中，Object.wait()方法的注释中有相关使用范例代码，如下图所示：</p>
<p><img src="/images/waitCodeExample.png" alt=""></p>
<p>2.1 synchronized的介绍</p>
<p>synchronized意为同步，它的使用有三种方法：</p>
<ol>
<li>synchronized(一个对象)  则将这个对象当成一把锁</li>
<li>static synchronized method()  synchronized用在静态方法上，由于静态方法不与任何对象相绑定，所以将Class对象当成一把锁</li>
<li>synchronized method()  synchronized用在实例方法(即非静态方法)上，则将该实例当成一把锁</li>
</ol>
<p>从上述代码可以看出，当条件成立的时候，进行等待wait()，直到另一个线程使用notify()/notifyAll()唤醒它，它再继续进行</p>
<p>3.具体代码实现</p>
<p>（1）首先需要一个盘子，采用Optional类作为盘子，value相当于盘子里的值(生产者生产完一个就放在盘子里，消费者从盘子里拿走)</p>
<p>Optional类常用的方法有：</p>
<ul>
<li>empty()  将内容置空</li>
<li>isPresent()  里面的内容是否存在</li>
<li>of(xxx)  返回一个Optional对象，将xxx存在里面</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> java.util.Optional<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Container</span> <span style="color:#f92672">{</span>    
    Optional<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> value <span style="color:#f92672">=</span> Optional<span style="color:#f92672">.</span><span style="color:#a6e22e">empty</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">public</span> Optional<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getValue</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>        
        <span style="color:#66d9ef">return</span> value<span style="color:#f92672">;</span>    
    <span style="color:#f92672">}</span>    
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setValue</span><span style="color:#f92672">(</span>Optional<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> value<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>        
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> value<span style="color:#f92672">;</span>    
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>（2）ProducerConsumer里有两个内部类，分别是Producer和Consumer</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> java.util.Optional<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.Random<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProducerConsumer</span> <span style="color:#f92672">{</span>    
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> InterruptedException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//声明 obj对象作为一个锁，container就相当于用来放随机数的盘子
</span><span style="color:#75715e"></span>        Object obj <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Object<span style="color:#f92672">();</span>        
        Container container <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Container<span style="color:#f92672">();</span>     
        
        Producer producer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Producer<span style="color:#f92672">(</span>obj<span style="color:#f92672">,</span> container<span style="color:#f92672">);</span>        
        Consumer consumer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Consumer<span style="color:#f92672">(</span>obj<span style="color:#f92672">,</span> container<span style="color:#f92672">);</span> 
        
        producer<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>        
        consumer<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>        
        producer<span style="color:#f92672">.</span><span style="color:#a6e22e">join</span><span style="color:#f92672">();</span>        
        consumer<span style="color:#f92672">.</span><span style="color:#a6e22e">join</span><span style="color:#f92672">();</span>    
    <span style="color:#f92672">}</span>    
    
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Producer</span> <span style="color:#66d9ef">extends</span> Thread <span style="color:#f92672">{</span>        
        <span style="color:#66d9ef">final</span> Object obj<span style="color:#f92672">;</span>        
        Container container<span style="color:#f92672">;</span>
        
        <span style="color:#75715e">/*通过构造器将锁 obj 和盘子 container 传递给Producer和Consumer，
</span><span style="color:#75715e">        使得他们共用同一把锁和同一个盘子，
</span><span style="color:#75715e">        这样就能保证每次只有一个线程可以拿到锁，往盘子里放东西或取东西。*/</span>
        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Producer</span><span style="color:#f92672">(</span>Object obj<span style="color:#f92672">,</span> Container container<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> obj<span style="color:#f92672">;</span>            
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">container</span> <span style="color:#f92672">=</span> container<span style="color:#f92672">;</span>        
        <span style="color:#f92672">}</span>        
        
        <span style="color:#a6e22e">@Override</span>        
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>            
            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 10<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
                <span style="color:#75715e">//生产者拿到了锁
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span>obj<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
                    <span style="color:#75715e">//当盘子里有东西时，说明消费者还没有消费，生产者需要等待
</span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>container<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">isPresent</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>                            
                            obj<span style="color:#f92672">.</span><span style="color:#a6e22e">wait</span><span style="color:#f92672">();</span>                        
                        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
                            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>                        
                        <span style="color:#f92672">}</span>                    
                    <span style="color:#f92672">}</span>
                    <span style="color:#75715e">//不符合while条件，说明盘子里没有东西，生产者开始生产随机数
</span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">int</span> r <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Random<span style="color:#f92672">().</span><span style="color:#a6e22e">nextInt</span><span style="color:#f92672">();</span>           
                    container<span style="color:#f92672">.</span><span style="color:#a6e22e">setValue</span><span style="color:#f92672">(</span>Optional<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span>r<span style="color:#f92672">));</span>     
                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Producing &#34;</span> <span style="color:#f92672">+</span> r<span style="color:#f92672">);</span>                
                <span style="color:#f92672">}</span>            
            <span style="color:#f92672">}</span>        
        <span style="color:#f92672">}</span>    
    <span style="color:#f92672">}</span>    
    
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Consumer</span> <span style="color:#66d9ef">extends</span> Thread <span style="color:#f92672">{</span>        
        <span style="color:#66d9ef">final</span> Object obj<span style="color:#f92672">;</span>        
        Container container<span style="color:#f92672">;</span>
        
        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Consumer</span><span style="color:#f92672">(</span>Object obj<span style="color:#f92672">,</span> Container container<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>  
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> obj<span style="color:#f92672">;</span>            
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">container</span> <span style="color:#f92672">=</span> container<span style="color:#f92672">;</span>        
        <span style="color:#f92672">}</span>        
        
        <span style="color:#a6e22e">@Override</span>        
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>            
            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 10<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>                
                <span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span>obj<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    <span style="color:#75715e">//盘子里没有东西，则消费者等待
</span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">while</span> <span style="color:#f92672">(!</span>container<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">isPresent</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>      
                        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>                            
                            obj<span style="color:#f92672">.</span><span style="color:#a6e22e">wait</span><span style="color:#f92672">();</span>                        
                        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>    
                            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>                        
                        <span style="color:#f92672">}</span>                    
                    <span style="color:#f92672">}</span>
                    <span style="color:#75715e">//不符合while条件，说明盘子里有东西，消费者开始消费
</span><span style="color:#75715e"></span>                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Consuming &#34;</span> <span style="color:#f92672">+</span> container<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">());</span>       
                <span style="color:#f92672">}</span>            
            <span style="color:#f92672">}</span>        
        <span style="color:#f92672">}</span>    
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>运行结果如下图所示。进行了十次依次进行生产消费随机数的过程。</p>
<p><img src="/images/ProducerAndConsumer1.png" alt=""></p>

                                </article>
                            
                        
                    
                        
                            
                                <article id="5asa57q/56il">
                                    <h2 class="major">多线程</h2>
                                    <span class="image main"><img src="" alt="" /></span>
                                    <ul>
<li><strong>为什么需要多线程？</strong></li>
</ul>
<ol>
<li>
<p>硬件需要：</p>
<p>CPU与其他设备的速度不同步，CPU很快，等执行完之后就进行等待，而且现在CPU大多是多核的，速度更快了。希望可以让CPU使用更加充分。</p>
</li>
<li>
<p>程序需要：</p>
<p>java的执行模型是同步/阻塞的：默认是单线程，在执行的过程中，执行完第一行再执行第二行，一步一步来。假如第一行是执行一个很慢的方法，那么就会等这个方法执行结束再继续，这样就需要等待很久。</p>
</li>
</ol>
<ul>
<li>
<p><strong>多线程的过程</strong></p>
<p>默认执行main线程，假如新开了线程a并start，那么就增加了一个执行流，main线程和线程a都有其私有的方法栈。</p>
</li>
<li>
<p><strong>start &amp; run 的区别</strong></p>
<ul>
<li>
<p>start相当于main线程（老板）给新线程（工人）分配完了之后就让工人自己去干活了，自己继续去做自己的事情。</p>
</li>
<li>
<p>run相当于main线程（老板）给新线程（工人）分配了活并进行监工，等工人干完活之后再去做自己的事情。</p>
<p><strong>如果让新线程执行run方法的话，和没有分多线程是一样的效果！！！只有start才可以并发执行！</strong></p>
</li>
</ul>
</li>
<li>
<p><strong>多线程会产生什么问题？</strong></p>
<p>同一份代码，不同人乱序运行，如果不是原子操作（某一时刻只能被一个线程操作），那么就会时好时坏，有时就会出错</p>
<p>例子：i 初始值为0，线程a和线程b都执行同一方法中的i++操作</p>
<p><!-- raw HTML omitted -->理想正确场景：<!-- raw HTML omitted --></p>
<p>线程a执行时 i 加1，变成1；线程b执行时 i 再加1，变成2（即使顺序调换，先线程b再线程a，结果也还是2）</p>
<p><!-- raw HTML omitted -->实际报错场景：<!-- raw HTML omitted --></p>
<p>i++分为三步：</p>
<p>(1) 取出 i 的值</p>
<p>(2) i 的值加 1</p>
<p>(3) 将叠加之后的值给 i</p>
<p>假设线程a先占用了CPU，取出 i 的初始值0，然后 i 加1变成了1。但是！此时线程a占用CPU的时间到了，所以轮到了线程b，由于线程a还没将数据赋值给 i ，所以 i 的值还是0，线程2成功在其基础上加1并赋值给 i ，那么 i 就变成了1。接下来又轮到了线程a，线程a直接将刚刚叠加之后的结果1赋值给 i 。<strong>最终结果就变成了 1 而不是2。</strong> 如下图所示。</p>
</li>
</ul>
<p><img src="/images/MultiThread.png" alt=""></p>
<ul>
<li>
<p><strong>什么时候使用多线程？</strong></p>
<p>一般分两种应用：</p>
<ul>
<li>
<p>CPU密集型应用  对于这种应用，多线程的效果略打折扣，因为CPU本来就处于繁忙状态，多线程的目的是充分使用CPU，提高CPU利用率。</p>
</li>
<li>
<p>IO密集型应用</p>
<p>包括网络IO（通常包括数据库）和文件IO</p>
<p>网络IO，例如平时访问数据库，本质就是通过DATABASE URL，从本地去访问数据库，整个过程也要经过网络IO，所以可以多线程处理其他的事情。</p>
<p>文件IO，例如下载文件，由于网络传输很慢，所以CPU可以先发送HTTP请求，然后多线程去做其他的事情，得到收到响应之后再继续。</p>
</li>
</ul>
</li>
</ul>

                                </article>
                            
                        
                    
                        
                            
                                <article id="5rex5ou36lsd5lio5rwf5ou36lsd">
                                    <h2 class="major">深拷贝与浅拷贝</h2>
                                    <span class="image main"><img src="" alt="" /></span>
                                    <p>Home里定义了Cat</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Home</span> <span style="color:#f92672">{</span>    
    <span style="color:#66d9ef">public</span> Cat cat<span style="color:#f92672">;</span>    
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Home</span><span style="color:#f92672">(</span>Cat cat<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>        
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">cat</span> <span style="color:#f92672">=</span> cat<span style="color:#f92672">;</span>    
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Cat有其名字</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Cat</span> <span style="color:#f92672">{</span>    
    <span style="color:#66d9ef">public</span> String name<span style="color:#f92672">;</span>    
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Cat</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>        
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name<span style="color:#f92672">;</span>    
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>在Main方法中定义一个Home类型的对象，对其进行拷贝</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Home home <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Home<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Cat<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Tom&#34;</span><span style="color:#f92672">));</span>
</code></pre></div><p>相当于将名为Tom的猫放在Home里</p>
<p>在这个具体的例子中，</p>
<p>浅拷贝：将这只名为Tom的猫也放到新房子里</p>
<p>深拷贝：重新定义一只名为Tom的猫，将其放到新房子里</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Home <span style="color:#a6e22e">shallowCopy</span><span style="color:#f92672">(</span>Home home<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>     
    Home newHome <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Home<span style="color:#f92672">(</span>home<span style="color:#f92672">.</span><span style="color:#a6e22e">cat</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> newHome<span style="color:#f92672">;</span>
    <span style="color:#75715e">//此处只为方便理解，建议直接return new Home(home.cat);
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><p>home.cat就是刚开始home对象里的猫，然后通过构造器将其直接放到新建的newHome里面。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Home <span style="color:#a6e22e">deepCopy</span><span style="color:#f92672">(</span>Home home<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>       
    Cat newCat <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Cat<span style="color:#f92672">(</span>home<span style="color:#f92672">.</span><span style="color:#a6e22e">cat</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span><span style="color:#f92672">);</span>
    Home newHome <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Home<span style="color:#f92672">(</span>newCat<span style="color:#f92672">);</span>       
    <span style="color:#66d9ef">return</span> newHome<span style="color:#f92672">;</span>
    <span style="color:#75715e">//此处只为方便理解，建议直接return new Home(new Cat(home.cat.name));
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><p>深拷贝时得到了与原来的home里的猫一样的名字，然后得到一只新猫newCat，最后再得到新房子newHome</p>
<p>该栗子中：</p>
<p>浅拷贝时，newHome与home这两个Home对象指向同一个cat</p>
<p>深拷贝的时候，newHome的cat和home的cat只是名字一致，是两个不同的cat对象。</p>
<p><strong>区别：</strong></p>
<p>浅拷贝里，原对象和浅克隆对象共享子对象；</p>
<p>深拷贝里，同时克隆子对象，所以相互独立，修改不会受影响</p>

                                </article>
                            
                        
                    
                        
                            
                                <article id="q29sbgvjdglvbus9k&#43;ezu&#43;eahow4uoeuqoexu&#43;wpiuwftuidjowqjueahoavsoanrue7k&#43;aeha">
                                    <h2 class="major">Collection体系的常用类及其背后的数据结构</h2>
                                    <span class="image main"><img src="" alt="" /></span>
                                    <p><img src="/images/collection.png" alt=""></p>
<p>集合有两个基本接口：Collection和Map</p>
<p>List是一个有序集合，Set里不包含重复元素，Queue是队列，遵循FIFO原则（First In First Out）</p>
<p><strong>List</strong></p>
<p>常用方法：</p>
<p>add()：增加元素</p>
<p>retainAll()：保留参数里的所有元素</p>
<p>containsAll()：是否包含参数这个集合里的所有元素</p>
<p>toArray()：转换成数组</p>
<p>1.ArrayList</p>
<p>2.LinkedList</p>
<p>3.Vector&amp;Stack</p>
<p>现已不使用</p>
<p><!-- raw HTML omitted -->ArrayList &amp; LinkedList：<!-- raw HTML omitted --></p>
<p>1.实现方式：ArrayList 基于数组来实现，LinkedList基于双向链表来实现</p>
<p>2.内存占用：LinkedList比ArrayList 更占内存，因为还需要存储两个引用（指向前面的元素和后面的元素）</p>
<p><strong>3.随机访问速度：ArrayList 更快</strong></p>
<p><strong>Set</strong></p>
<p>1.EnumSet</p>
<p>该Set里的元素必须都是指定枚举类型的枚举值</p>
<p>2.HashSet</p>
<p>3.TreeSet</p>
<p><!-- raw HTML omitted -->HashSet &amp; TreeSet<!-- raw HTML omitted --></p>
<p>HashSet是二叉树实现的，加入的元素<strong>不一定</strong>和加入的顺序保持一致，这一点就和ArrayList不一样</p>
<p>TreeSet是SortedSet接口的唯一实现，元素是有序的，可以采用默认的排序方法，也可以自定义排序方法</p>
<p><strong>Queue</strong></p>
<p>1.Deque</p>
<p>双端队列，两端均可增加可减少元素</p>
<p>2.PriorityQueue</p>
<p>有优先级的队列，按关键字进行排序，插入元素的时候会自动找到合适位置插入</p>
<p><strong>Map</strong></p>
<p>1.HashMap</p>
<p>HashMap的实现没有被同步，所以它是线程不安全的，ConcurrentHashMap是线程安全的</p>
<p>HashMap在resize扩容的时候会造成死循环</p>
<p>2.TreeMap</p>
<p>TreeMap是基于红黑树实现的</p>

                                </article>
                            
                        
                    
                        
                            
                                <article id="smf2yeeahowmheeuoeeqhus4jk1hdmvu">
                                    <h2 class="major">Java的包管理与Maven</h2>
                                    <span class="image main"><img src="" alt="" /></span>
                                    <p>1.JVM（java虚拟机）的作用：</p>
<p>只执行class文件，也就是字节码文件，如果遇到了新类就会去相应类路径classPath里找。各个类的字节码文件一般都打包在jar包里。</p>
<p>2.传递性依赖：类依赖其他类</p>
<p>maven的包管理解决了传递性依赖和包冲突：
实现生产者-消费者(一)：Object.wait() &amp; notify()notifyAll()
1）传递性依赖的解决：</p>
<p>maven会告诉jvm到底去哪找，根据groupId/artifactId/version去中央仓库可以找到自己想要的jar包，对应的jar包还有其pom文件，文件里会说明它又依赖了什么jar包，所以整棵依赖树都会被下载下来</p>
<p>2）包冲突的解决：</p>
<p>【1】包冲突是什么？版本号不同的包名同时出现在classPath里，则jvm不知道到底采用哪个包</p>
<p>【2】包冲突的表现：</p>
<p><strong>AbstractMethodError</strong></p>
<p><strong>NoClassDefFoundError</strong></p>
<p><strong>ClassNotFoundException</strong></p>
<p><strong>LinkageError</strong></p>
<p><strong>NoSuchMethodError</strong></p>
<p>【3】看包依赖的方法</p>
<p>法1：看右侧maven的dependencies</p>
<p><img src="/images/way1_dependencies.png" alt=""></p>
<p>法2：命令行里执行mvn dependency:tree 看到的是maven解决冲突之后的结构</p>
<p><img src="/images/way2.png" alt=""></p>
<p>【4】
解决冲突的原则：</p>
<p>选择距离项目最近的jar包</p>
<p>当距离项目一样近时，选前者</p>
<p>【5】实例：</p>
<p><img src="/images/instance.png" alt=""></p>
<p>因为此时既依赖了0.1版本的C包，又依赖了0.2版本的C包，所以产生了包冲突</p>
<p>所以maven在解决包冲突的时候，选择了较近的0.1版本的C包，而舍弃了高版本</p>
<p>当高版本的jar包里有我们需要的方法时，此时就会报错，要想采用高版本的jar包，有以下几种方式：</p>
<p>① 直接依赖0.2版本的C包，修改pom.xml文件的dependencies</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>    
    <span style="color:#f92672">&lt;groupId&gt;</span>com.github.hcsp<span style="color:#f92672">&lt;/groupId&gt;</span>    
    <span style="color:#f92672">&lt;artifactId&gt;</span>test-library-c<span style="color:#f92672">&lt;/artifactId&gt;</span>    
    <span style="color:#f92672">&lt;version&gt;</span>0.2<span style="color:#f92672">&lt;/version&gt;</span>    
<span style="color:#f92672">&lt;/dependency&gt;</span>
</code></pre></div><p>② 排除掉0.1版本的C包</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>com.github.hcsp<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>test-library-d<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;version&gt;</span>0.1<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;exclusions&gt;</span>
        <span style="color:#f92672">&lt;exclusion&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>com.github.hcsp<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>test-library-c<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;/exclusion&gt;</span>
    <span style="color:#f92672">&lt;/exclusions&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span>
</code></pre></div><p>③ 采用IDEA的Maven Helper插件</p>
<p>打开pom，命令行上方有dependency Analyzer 点Reimport按钮，则显示了maven冲突的地方，<strong>选中要排除的那个</strong>,然后右键exclude</p>

                                </article>
                            
                        
                    
                        
                            
                                <article id="57g755qe6k6/6zeu5o6n5yi256ymchvibglj44cbchjvdgvjdgvk44cbzgvmyxvsdooagxbyaxzhdgu">
                                    <h2 class="major">类的访问控制符public、protected、default、private</h2>
                                    <span class="image main"><img src="" alt="" /></span>
                                    <ul>
<li>private仅本类可用</li>
<li>package private包级私有（默认不写修饰符）仅本包及本类可用</li>
<li>protected 本类、本包、其子类均可用</li>
<li>public没有限制</li>
</ul>
<p>具体如下图所示：</p>
<p><img src="/images/private&amp;protected&amp;public.png" alt=""></p>

                                </article>
                            
                        
                    
                        
                            
                                <article id="shvnb&#43;aqrew7uus4qus6uuwnmuwuog">
                                    <h2 class="major">Hugo搭建个人博客</h2>
                                    <span class="image main"><img src="" alt="" /></span>
                                    <p>1.安装hugo</p>
<p>Windows:</p>
<ul>
<li>下载windows相应版本的压缩包（对应32位/64位）并解压</li>
<li>将hugo.exe放到D:\softwares\hugo\hugo.exe</li>
<li>将D:\softwares\hugo加到PATH中</li>
<li>重启终端，运行hugo version查看版本验证安装成功</li>
</ul>
<p>Mac:</p>
<ul>
<li>
<p>brew install hugo</p>
</li>
<li>
<p>hugo version 验证安装成功</p>
<p>执行这两行代码即可</p>
</li>
</ul>
<p>2.参照文档搭建博客</p>
<ul>
<li>
<p>进入hugo官网 <a href="https://gohugo.io/">https://gohugo.io/</a> ，点击 Quick Start，则有搭建的全部步骤</p>
<p>在搭建之前，先打开一个目录，例如进入到D盘，然后cmder(即：在此处打开命令窗口)</p>
</li>
<li>
<p>直接从官网步骤的第二步开始抄代码，一直到第七步</p>
<p>【2】create new site</p>
<p><code>hugo new site xxx.github.io-generator</code></p>
<p>xxx要小写，是自己的github用户名，则会在当前目录创建这个网站</p>
</li>
<li>
<p><code>code xxx.github.io-generator/</code></p>
<p>则会在VSCode里打开该目录</p>
</li>
<li>
<p>【3】add a theme
打开终端，继续照抄代码</p>
</li>
<li>
<p>【4】add some content 创建文章，自己命名即可</p>
</li>
<li>
<p>可以找到该md文件，直接写博客了，<strong>修改draft:true为draft:false</strong></p>
</li>
<li>
<p>【5】Start the Hugo server
可以看到网站地址了，ctrl+鼠标左键点进去就可以看到自己写的博客</p>
</li>
<li>
<p>【6】Customize the Theme
配置主题，在VSCode里ctrl+P搜config.toml文件在哪，
语言改成zh-Hans，即简体中文，title也可以改一下</p>
</li>
<li>
<p>【7】Build static pages
新开一个终端，<strong>刚刚的不要关</strong>，运行hugo。则创建一个新的目录public，这就是博客站点</p>
</li>
<li>
<p>hugo server -D 可以预览草稿</p>
<p>hugo server 预览非草稿</p>
<p>至此，本地就可以看到自己用hugo搭建的博客了</p>
</li>
</ul>

                                </article>
                            
                        
                    
                        
                            
                                <article id="5oir55qe56ys5lia56&#43;h5y2a5a6i">
                                    <h2 class="major">我的第一篇博客</h2>
                                    <span class="image main"><img src="" alt="" /></span>
                                    <p><strong># 大家好</strong></p>
<p>这是我的第一篇博客，希望可以将工作和学习中的内容多多总结，记录下来，也需要对别人有所帮助。</p>

                                </article>
                            
                        
                    

                </div>

                
<footer id="footer">
    <p class="copyright">&copy; Design: <a href="https://github.com/d-asnaghi">d-asnaghi</a> and <a href="https://html5up.net">HTML5 UP</a>.</p>
</footer>

        </div>

    
    <div id="bg"></div>

</body>


    
    <script src=https://xuepan-summer.github.io/summer-xuepan.github.io/assets/js/jquery.min.js></script>
    <script src=https://xuepan-summer.github.io/summer-xuepan.github.io/assets/js/browser.min.js></script>
    <script src=https://xuepan-summer.github.io/summer-xuepan.github.io/assets/js/breakpoints.min.js></script>
    <script src=https://xuepan-summer.github.io/summer-xuepan.github.io/assets/js/util.js></script>
    <script src=https://xuepan-summer.github.io/summer-xuepan.github.io/assets/js/main.js></script>

</html>
